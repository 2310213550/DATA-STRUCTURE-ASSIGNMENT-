#include <stdio.h>
#include <stdlib.h>

/* Node structure */
struct Node {
    int data;
    struct Node *next;
};

/* Insert node at end */
struct Node* insert(struct Node *head, int data) {
    struct Node *newNode = (struct Node*)malloc(sizeof(struct Node));
    newNode->data = data;

    if (head == NULL) {
        newNode->next = newNode;
        return newNode;
    }

    struct Node *temp = head;
    while (temp->next != head)
        temp = temp->next;

    temp->next = newNode;
    newNode->next = head;

    return head;
}

/* Traverse circular linked list */
void traverse(struct Node *head) {
    struct Node *temp;

    if (head == NULL) {
        printf("List is empty\n");
        return;
    }

    temp = head;
    do {
        printf("%d -> ", temp->data);
        temp = temp->next;
    } while (temp != head);

    printf("(back to head)\n");
}

/* Delete at beginning */
struct Node* deleteBeginning(struct Node *head) {
    struct Node *temp, *last;

    if (head == NULL)
        return NULL;

    if (head->next == head) {
        free(head);
        return NULL;
    }

    last = head;
    while (last->next != head)
        last = last->next;

    temp = head;
    head = head->next;
    last->next = head;
    free(temp);

    return head;
}

/* Delete at end */
struct Node* deleteEnd(struct Node *head) {
    struct Node *temp, *prev = NULL;

    if (head == NULL)
        return NULL;

    if (head->next == head) {
        free(head);
        return NULL;
    }

    temp = head;
    while (temp->next != head) {
        prev = temp;
        temp = temp->next;
    }

    prev->next = head;
    free(temp);

    return head;
}

/* Delete specific key */
struct Node* deleteKey(struct Node *head, int key) {
    struct Node *temp = head, *prev = NULL;

    if (head == NULL)
        return NULL;

    do {
        if (temp->data == key) {
            if (temp == head)
                return deleteBeginning(head);
            else {
                prev->next = temp->next;
                free(temp);
                return head;
            }
        }
        prev = temp;
        temp = temp->next;
    } while (temp != head);

    printf("Key not found\n");
    return head;
}

/* Interleave two circular linked lists */
struct Node* interleave(struct Node *head1, struct Node *head2) {
    struct Node *p1 = head1, *p2 = head2;
    struct Node *n1, *n2;

    if (!head1) return head2;
    if (!head2) return head1;

    do {
        n1 = p1->next;
        n2 = p2->next;

        p1->next = p2;
        if (n1 == head1)
            break;

        p2->next = n1;

        p1 = n1;
        p2 = n2;

    } while (p1 != head1 && p2 != head2);

    return head1;
}

/* Main function */
int main() {
    struct Node *head1 = NULL, *head2 = NULL;
    int choice, value;

    while (1) {
        printf("\n--- Circular Linked List Menu ---\n");
        printf("1. Insert into List 1\n");
        printf("2. Insert into List 2\n");
        printf("3. Traverse List 1\n");
        printf("4. Traverse List 2\n");
        printf("5. Delete Beginning (List 1)\n");
        printf("6. Delete End (List 1)\n");
        printf("7. Delete Specific Element (List 1)\n");
        printf("8. Interleave List 1 & List 2\n");
        printf("9. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
        case 1:
            printf("Enter value: ");
            scanf("%d", &value);
            head1 = insert(head1, value);
            break;

        case 2:
            printf("Enter value: ");
            scanf("%d", &value);
            head2 = insert(head2, value);
            break;

        case 3:
            traverse(head1);
            break;

        case 4:
            traverse(head2);
            break;

        case 5:
            head1 = deleteBeginning(head1);
            break;

        case 6:
            head1 = deleteEnd(head1);
            break;

        case 7:
            printf("Enter key to delete: ");
            scanf("%d", &value);
            head1 = deleteKey(head1, value);
            break;

        case 8:
            head1 = interleave(head1, head2);
            printf("Lists interleaved successfully\n");
            break;

        case 9:
            exit(0);

        default:
            printf("Invalid choice\n");
        }
    }
}
